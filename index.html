<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbx2QIfcMMAAxp2GSzs2yhQGwYWGdy3YV_QLFoF0ySuIT2MD3fjTldc10dSEzd8VwI4D/exec"; 

document.getElementById("bestellForm").addEventListener("submit", function(e) {
  e.preventDefault();

  const formData = new FormData(this);
  const params = new URLSearchParams(formData);

  fetch(scriptURL, {
    method: "POST",
    body: params
  })
  .then(res => res.text())
  .then(text => {
    console.log("Antwort:", text);
    this.reset();
    ladeBestellungen(); // ⬅ direkt nach dem Speichern neu laden
  })
  .catch(err => {
    console.error("Fehler:", err);
    alert("Fehler beim Speichern");
  });
});

// Liste laden
function ladeBestellungen() {
  fetch(scriptURL) // einfacher GET → kein CORS-Problem
    .then(res => res.json())
    .then(daten => {
      const tbody = document.querySelector("#bestellTabelle tbody");
      tbody.innerHTML = "";
      daten.forEach(zeile => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${zeile["Bereich"] || ""}</td>
          <td>${zeile["Anzahl"] || ""}</td>
          <td>${zeile["Produkt"] || ""}</td>
          <td>${zeile["Farbe"] || ""}</td>
          <td>${zeile["Format"] || ""}</td>
          <td>${zeile["Dicke"] || ""}</td>
          <td>${zeile["ArtNr"] || ""}</td>
        `;
        tbody.appendChild(tr);
      });
    })
    .catch(err => console.error("Fehler beim Laden:", err));
}

// Beim Laden der Seite direkt Liste anzeigen
document.addEventListener("DOMContentLoaded", ladeBestellungen);
</script>
